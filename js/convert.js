const conversionTable = {
    'ぁ': 'あ', 'ぃ': 'い', 'ぅ': 'う', 'ぇ': 'え', 'ぉ': 'お',
    'っ': 'つ', 'ゃ': 'や', 'ゅ': 'ゆ', 'ょ': 'よ', 'ゎ': 'わ',
    'を': 'お',
    'ア': 'あ', 'イ': 'い', 'ウ': 'う', 'エ': 'え', 'オ': 'お',
    'カ': 'か', 'キ': 'き', 'ク': 'く', 'ケ': 'け', 'コ': 'こ',
    'サ': 'さ', 'シ': 'し', 'ス': 'す', 'セ': 'せ', 'ソ': 'そ',
    'タ': 'た', 'チ': 'ち', 'ツ': 'つ', 'テ': 'て', 'ト': 'と',
    'ナ': 'な', 'ニ': 'に', 'ヌ': 'ぬ', 'ネ': 'ね', 'ノ': 'の',
    'ハ': 'は', 'ヒ': 'ひ', 'フ': 'ふ', 'ヘ': 'へ', 'ホ': 'ほ',
    'マ': 'ま', 'ミ': 'み', 'ム': 'む', 'メ': 'め', 'モ': 'も',
    'ヤ': 'や', 'ユ': 'ゆ', 'ヨ': 'よ',
    'ラ': 'ら', 'リ': 'り', 'ル': 'る', 'レ': 'れ', 'ロ': 'ろ',
    'ワ': 'わ', 'ヲ': 'を', 'ン': 'ん',
    'ガ': 'が', 'ギ': 'ぎ', 'グ': 'ぐ', 'ゲ': 'げ', 'ゴ': 'ご',
    'ザ': 'ざ', 'ジ': 'じ', 'ズ': 'ず', 'ゼ': 'ぜ', 'ゾ': 'ぞ',
    'ダ': 'だ', 'ヂ': 'ぢ', 'ヅ': 'づ', 'デ': 'で', 'ド': 'ど',
    'バ': 'ば', 'ビ': 'び', 'ブ': 'ぶ', 'ベ': 'べ', 'ボ': 'ぼ',
    'パ': 'ぱ', 'ピ': 'ぴ', 'プ': 'ぷ', 'ペ': 'ぺ', 'ポ': 'ぽ',
    'ー': ''
};

function convertToHiragana(text) {
    return text.split('').map(char => conversionTable[char] || char).join('');
}

function normalizeWord(word) {
    // のばしぼうを処理する前の文字を取得
    let normalized = '';
    for (let i = 0; i < word.length; i++) {
        if (word[i] === 'ー' && i > 0) {
            // のばしぼうの場合、前の文字を保持
            normalized += normalized[normalized.length - 1];
        } else {
            normalized += conversionTable[word[i]] || word[i];
        }
    }
    return normalized;
}

function isValidInput(text) {
    return /^[ぁ-んァ-ンー]*$/.test(text);
}

function isValidContinuation(prevWord, nextWord) {
    if (!prevWord || !nextWord) return true;
    
    const normalizedPrev = normalizeWord(prevWord);
    const normalizedNext = normalizeWord(nextWord);
    
    const lastChar = normalizedPrev.slice(-1);
    const firstChar = normalizedNext.charAt(0);
    
    return lastChar === firstChar;
}